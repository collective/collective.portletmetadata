<tal:block repeat="portlet options/portlets">
    <tal:block condition="portlet/settings/exclude_search | nothing">
      <tal:block content="structure string:&lt;!-- googleoff: all --&gt;"></tal:block>
    </tal:block>
    <div tal:define="picture portlet/settings/image|nothing;
                     picture_class python: picture and 'portletMetadataHasImage' or '';
                     css_class portlet/settings/css_class|string:;"
         tal:attributes="id string:portletwrapper-${portlet/hash};
                         class string:portletWrapper kssattr-portlethash-${portlet/hash} ${css_class} ${picture_class};">
       <img tal:define="picture portlet/settings/image|nothing"
            tal:condition="picture"
            tal:attributes="src string:${context/absolute_url}/${portlet/name}/edit-portlet-metadata/++widget++form.widgets.image/@@download"
            class="portletMetadataImage" />
       <tal:block tal:content="structure python:view.safe_render(portlet['renderer'])" />
    </div>
    <tal:block condition="portlet/settings/exclude_search | nothing">
      <tal:block content="structure string:&lt;!-- googleon: all --&gt;"/>
    </tal:block>
</tal:block>

<div class="managePortletsLink" tal:condition="view/can_manage_portlets"
      i18n:domain="plone">
  <a title="View portlet management screen"
     i18n:attributes="title"
     i18n:translate="manage_portlets_link"
     tal:attributes="href string:${view/base_url}/@@manage-portlets"
     >Manage portlets</a>
</div>
